import{r,j as t}from"./index-C2aJ28FA.js";const v="/.netlify/functions/auth-session",_=`${v}?action=login`,$=`${v}?action=me`,F="/.netlify/functions/reset-dispatch";function T(){const[m,j]=r.useState(""),[h,S]=r.useState(""),[f,p]=r.useState(!1),[x,l]=r.useState(null),[g,o]=r.useState(null),[N,c]=r.useState(!1),[w,E]=r.useState(""),[y,u]=r.useState(!1),d=r.useMemo(()=>{try{const e=new URLSearchParams(window.location.search).get("next")||"";return e.startsWith("/")?e:""}catch{return""}},[]);r.useEffect(()=>{(async()=>{try{const s=window.localStorage.getItem("elevea_last_email")||"";if(!s)return;const a=await(await fetch(`${$}&email=${encodeURIComponent(s)}`,{method:"GET",cache:"no-store"})).json().catch(()=>({}));a!=null&&a.ok&&a.user&&b(a.user.role,d)}catch{}})()},[d]);function b(s,e){if(e&&(s==="admin"&&e.startsWith("/admin/")||s==="client"&&e.startsWith("/client/")))return void window.location.assign(e);window.location.assign(s==="admin"?"/admin/dashboard":"/client/dashboard")}async function k(s){var e;s.preventDefault(),o(null),l(null),p(!0);try{const a=m.trim().toLowerCase(),n=await fetch(_,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"login",email:a,password:h})});if(n.status>=500){const R=await n.text().catch(()=>"");o(`Servidor indisponível (${n.status}). ${R||""}`.trim());return}const i=await n.json().catch(()=>({}));if(!n.ok||i.ok===!1){o(i.error||i.message||`Falha no login (${n.status})`);return}if(!((e=i.user)!=null&&e.role)){o("Resposta inválida do servidor.");return}try{window.localStorage.setItem("elevea_last_email",a)}catch{}b(i.user.role,d)}catch(a){o((a==null?void 0:a.message)||"Erro de rede")}finally{p(!1)}}async function L(s){try{const e=s.trim().toLowerCase();if(!e||!/^\S+@\S+\.\S+$/.test(e))return{ok:!1,error:"email_invalido"};u(!0);const a=await fetch(F,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),n=await a.json().catch(()=>({}));return u(!1),!a.ok||(n==null?void 0:n.ok)===!1?{ok:!1,error:(n==null?void 0:n.error)||(n==null?void 0:n.message)||`http_${a.status}`}:{ok:!0}}catch(e){return u(!1),{ok:!1,error:String((e==null?void 0:e.message)||e)}}}async function C(s){s.preventDefault(),o(null),l(null);const e=await L(w);if(!e.ok){o(e.error||"Falha ao enviar o link");return}l("Se o e-mail existir, enviamos um link de redefinição."),c(!1)}return t.jsxs("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-6",children:[t.jsxs("div",{className:"w-full max-w-md bg-white rounded-2xl shadow p-8",children:[t.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Entrar"}),t.jsxs("form",{className:"space-y-4",onSubmit:k,children:[t.jsx("input",{type:"email",placeholder:"E-mail",value:m,onChange:s=>j(s.target.value),className:"w-full border rounded-xl px-4 py-3",autoComplete:"username",required:!0}),t.jsx("input",{type:"password",placeholder:"Senha",value:h,onChange:s=>S(s.target.value),className:"w-full border rounded-xl px-4 py-3",autoComplete:"current-password",required:!0}),t.jsx("button",{type:"submit",disabled:f,className:"w-full bg-black text-white rounded-xl py-3 hover:bg-gray-800",children:f?"Entrando...":"Entrar"})]}),t.jsx("div",{className:"mt-4 text-sm",children:t.jsx("button",{className:"text-blue-600 underline",onClick:()=>c(!0),children:"Esqueci a senha"})}),g&&t.jsx("div",{className:"mt-4 text-red-600 whitespace-pre-wrap",children:g}),x&&t.jsx("div",{className:"mt-4 text-green-600 break-words",children:x})]}),N&&t.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center",children:t.jsxs("div",{className:"bg-white w-full max-w-md rounded-xl shadow p-6",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Reset de Senha"}),t.jsxs("form",{className:"space-y-4",onSubmit:C,children:[t.jsx("input",{type:"email",placeholder:"E-mail",value:w,onChange:s=>E(s.target.value),className:"w-full border rounded-xl px-4 py-3",required:!0}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{type:"submit",className:"bg-black text-white rounded-xl px-4 py-2",disabled:y,children:y?"Enviando...":"Enviar link"}),t.jsx("button",{type:"button",className:"border rounded-xl px-4 py-2",onClick:()=>c(!1),children:"Fechar"})]})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Você receberá um link para criar uma nova senha."})]})})]})}export{T as default};
//# sourceMappingURL=Login-961roo0b.js.map
