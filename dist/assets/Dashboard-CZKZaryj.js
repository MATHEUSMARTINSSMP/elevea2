import{u as le,r,j as e}from"./index-BzNBZ-MS.js";const ne=7e3,y=15e3,H="https://www.mercadopago.com.br/subscriptions/checkout?preapproval_plan_id=99dceb0e108a4f238a84fbef3e91bab8",re=[{name:"Azul Futurista",colors:["#0f172a","#3b82f6","#38bdf8"]},{name:"Verde Tech",colors:["#064e3b","#10b981","#34d399"]},{name:"Roxo Premium",colors:["#312e81","#8b5cf6","#a78bfa"]},{name:"Laranja Energia",colors:["#7c2d12","#f97316","#fb923c"]}],$=t=>String(t??"").trim().toLowerCase(),_=t=>!!t&&($(t)==="vip"||$(t).includes("vip")),J=t=>["approved","authorized","active","processing","in_process","charged","authorized_pending_capture"].includes($(t)),I=t=>{if(!t)return"—";const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})+" • "+n.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})};async function k(t,n){const d=new AbortController,m=setTimeout(()=>d.abort(),n);try{const h=await fetch(t,{credentials:"include",signal:d.signal}),x=await h.text();let u={};try{u=x?JSON.parse(x):{}}catch{}if(!h.ok)throw new Error(u&&u.error||`HTTP ${h.status}`);return u}finally{clearTimeout(m)}}async function E(t,n,d){const m=new AbortController,h=setTimeout(()=>m.abort(),d);try{const x=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n),signal:m.signal}),u=await x.text();let p={};try{p=u?JSON.parse(u):{}}catch{}if(!x.ok)throw new Error(p&&p.error||`HTTP ${x.status}`);return p}finally{clearTimeout(h)}}function me(){var q;const{user:t}=le(),n=!!(t!=null&&t.email)&&!!(t!=null&&t.siteSlug)&&(t==null?void 0:t.role)==="client",[d,m]=r.useState(null),[h,x]=r.useState(!1),[u,p]=r.useState(null),f=`dashboard:lastPlan:${(t==null?void 0:t.siteSlug)||""}`,F=r.useRef(!1),[G,K]=r.useState(0),[o,A]=r.useState(null),[T,R]=r.useState(!0),[b,w]=r.useState({}),[v,Q]=r.useState(!0),[L,U]=r.useState([]),[W,X]=r.useState(!0),[Y,V]=r.useState(Array.from({length:6}).map((a,s)=>({key:`media_${s+1}`,label:`Mídia ${s+1}`}))),[Z,ee]=r.useState(!0),[g,te]=r.useState(""),[B,D]=r.useState(!1),N=_(d||void 0)||_(o==null?void 0:o.plan)||J(o==null?void 0:o.status),O=d===null?"—":N?"vip":d||"—";r.useEffect(()=>{(t==null?void 0:t.role)==="admin"&&window.location.replace("/admin/dashboard")},[t==null?void 0:t.role]),r.useEffect(()=>{if(!n)return;if(!F.current){F.current=!0;try{const s=sessionStorage.getItem(f);s&&m(s)}catch{}}let a=!0;return(async()=>{x(!0),p(null);try{const s=await k(`/.netlify/functions/client-plan?site=${encodeURIComponent(t.siteSlug)}&email=${encodeURIComponent(t.email)}`,ne);if(!a)return;const i=s.vip?"vip":s.plan||"";m(i);try{sessionStorage.setItem(f,i)}catch{}A(l=>({...l||{ok:!0,siteSlug:t.siteSlug},status:s.status||(l==null?void 0:l.status),nextCharge:s.nextCharge??(l==null?void 0:l.nextCharge)??null,lastPayment:s.lastPayment??(l==null?void 0:l.lastPayment)??null,plan:i}))}catch{p("Não foi possível validar sua assinatura agora.")}finally{a&&x(!1)}})(),()=>{a=!1}},[n,t==null?void 0:t.siteSlug,t==null?void 0:t.email,G]);const ae=()=>{try{sessionStorage.removeItem(f)}catch{}m(null),p(null),R(!0),K(a=>a+1)};r.useEffect(()=>{if(!n)return;let a=!0;return(async()=>{try{const s=await k(`/.netlify/functions/client-api?action=get_status&site=${encodeURIComponent(t.siteSlug)}`,y);if(!a)return;if(A(s),!_(d||void 0)&&(_(s.plan)||J(s.status))){m("vip");try{sessionStorage.setItem(f,"vip")}catch{}}}catch{}finally{a&&R(!1)}})(),(async()=>{try{const s=await k(`/.netlify/functions/client-api?action=get_settings&site=${encodeURIComponent(t.siteSlug)}`,y).catch(()=>({ok:!0,settings:{}}));if(!a)return;w(i=>({...i,...s.settings||{}}))}catch{}finally{a&&Q(!1)}})(),(async()=>{try{const s=await k(`/.netlify/functions/assets?site=${encodeURIComponent(t.siteSlug)}`,y).catch(()=>({ok:!0,items:[]}));if(!a)return;const i=new Map(s.items.map(c=>[c.key,c.url])),l={media_1:["media_1","hero","banner","principal"],media_2:["media_2","destaque_1","gallery_1"],media_3:["media_3","destaque_2","gallery_2"],media_4:["media_4","gallery_3"],media_5:["media_5","gallery_4"],media_6:["media_6","gallery_5"]};V(c=>c.map(j=>{const P=(l[j.key]||[j.key]).find(S=>i.get(S));return{...j,url:P?i.get(P):j.url}}))}catch{}finally{a&&ee(!1)}})(),(async()=>{try{let s;if(N&&g.trim()?s=await E("/.netlify/functions/client-api",{action:"list_feedbacks_secure",site:t.siteSlug,page:1,pageSize:50,pin:g.trim()},y).catch(()=>({ok:!0,items:[]})):s=await k(`/.netlify/functions/client-api?action=list_feedbacks&site=${encodeURIComponent(t.siteSlug)}`,y).catch(()=>({ok:!0,items:[]})),!a)return;U(s.items||[])}catch{}finally{a&&X(!1)}})(),()=>{a=!1}},[n,t==null?void 0:t.siteSlug,t==null?void 0:t.email,N,g]);async function z(a){if(n){D(!0);try{const s={...b,...a};if(!(await E("/.netlify/functions/client-api",{action:"save_settings",site:t.siteSlug,settings:s,pin:g||void 0},y)).ok)throw new Error("Falha ao salvar");w(s)}catch(s){alert((s==null?void 0:s.message)||"Erro ao salvar configurações")}finally{D(!1)}}}async function se(a,s){if(!n)return;const i=new FormData;i.append("site",t.siteSlug),i.append("section","generic"),i.append("key",a.key),i.append("file",s),i.append("email",t.email);const l=await fetch("/.netlify/functions/assets",{method:"PUT",body:i,credentials:"include"}),c=await l.json().catch(()=>({}));if(!l.ok||c.ok===!1)throw new Error((c==null?void 0:c.error)||`Falha no upload (${l.status})`);const j=c.url;V(P=>P.map(S=>S.key===a.key?{...S,url:j}:S))}async function M(a,s){if(n)try{await E("/.netlify/functions/client-api",{action:"feedback_set_approval",site:t.siteSlug,id:a,approved:s,pin:g||void 0},y),U(i=>i.map(l=>l.id===a?{...l,approved:s}:l))}catch(i){alert((i==null?void 0:i.message)||"Não foi possível atualizar a aprovação.")}}function ie(){try{localStorage.removeItem("auth")}catch{}window.location.href="/login"}return t?e.jsx("div",{className:"min-h-screen bg-[#0B1220] p-6 text-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("header",{className:"rounded-2xl border border-white/10 bg-white text-slate-900 p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:"/logo-elevea.png",alt:"ELEVEA",className:"h-6 w-auto"}),e.jsxs("div",{className:"text-xs md:text-sm text-slate-600",children:[t.email," ",t.siteSlug?`• ${t.siteSlug}`:"• sem site"," ",`• ${O}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[N?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"rounded-xl bg-emerald-500/15 text-emerald-700 border border-emerald-300 px-3 py-1 text-xs font-medium",children:"VIP ativo"}),e.jsx("input",{value:g,onChange:a=>te(a.target.value),placeholder:"PIN VIP",className:"rounded-xl bg-white/70 text-black px-3 py-2 text-xs"})]}):h?e.jsx("span",{className:"rounded-xl bg-slate-200 text-slate-700 px-3 py-2 text-xs",children:"Verificando…"}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:H,target:"_blank",rel:"noreferrer",className:"rounded-xl bg-emerald-500 px-4 py-2 text-sm font-medium hover:bg-emerald-400 text-black",children:"Desbloquear VIP"}),e.jsx("button",{onClick:ae,className:"rounded-xl bg-slate-900 text-white px-3 py-2 text-xs hover:opacity-90",title:"Se você é VIP e não apareceu, tente novamente",children:"Tentar novamente"})]}),e.jsx("button",{onClick:ie,className:"rounded-xl bg-slate-900 text-white px-4 py-2 text-sm hover:opacity-90",children:"Sair"})]})]}),u?e.jsx("div",{className:"rounded-2xl bg-yellow-900/30 border border-yellow-700/50 text-yellow-100 px-4 py-3",children:u}):null,e.jsxs("section",{className:"grid md:grid-cols-4 gap-4",children:[e.jsx(C,{title:"Status",value:T?"—":o!=null&&o.status?o.status.toUpperCase():"—"}),e.jsx(C,{title:"Plano",value:O}),e.jsx(C,{title:"Próxima Cobrança",value:T?"—":I(o==null?void 0:o.nextCharge)}),e.jsx(C,{title:"Último Pagamento",value:T?"—":o!=null&&o.lastPayment?`${I(o.lastPayment.date)} • R$ ${o.lastPayment.amount.toFixed(2)}`:"—"})]}),e.jsxs(oe,{enabled:N,checking:h,teaser:"No VIP você pode trocar imagens, textos e cores do seu site em tempo real.",children:[e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-white/[0.03] p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:"Banco de Mídias"}),e.jsxs("div",{className:"text-xs text-white/60",children:["Dica: envie arquivos na pasta do Drive: ",e.jsxs("em",{children:["Elevea Sites / SITE-",t==null?void 0:t.siteSlug," / logo, fotos"]}),"."]})]}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:Y.map(a=>e.jsx(ce,{slot:a,loading:Z,onSelectFile:async s=>{try{await se(a,s)}catch(i){alert((i==null?void 0:i.message)||"Falha no upload")}}},a.key))})]}),e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-white/[0.03] p-6 space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Textos & Títulos"}),e.jsxs("div",{className:"grid gap-2 max-w-2xl",children:[e.jsx("label",{className:"text-sm text-white/70",children:"Título do topo (Hero)"}),e.jsx("input",{disabled:v,className:"w-full rounded-xl bg-white/5 border border-white/10 px-4 py-2 text-white placeholder-white/40 disabled:opacity-60",placeholder:"Ex.: Sua empresa, seu próximo nível",value:b.heroTitle||"",onChange:a=>w(s=>({...s,heroTitle:a.target.value}))})]}),e.jsxs("div",{className:"grid gap-2 max-w-2xl",children:[e.jsx("label",{className:"text-sm text-white/70",children:'Texto da seção "Sobre"'}),e.jsx("textarea",{disabled:v,className:"w-full rounded-xl bg-white/5 border border-white/10 px-4 py-2 text-white placeholder-white/40 min-h-[100px] disabled:opacity-60",placeholder:"Conte em poucas linhas a história ou diferencial do seu negócio.",value:b.aboutText||"",onChange:a=>w(s=>({...s,aboutText:a.target.value}))})]}),b.services&&b.services.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:b.services.map((a,s)=>e.jsxs("div",{className:"rounded-xl bg-white/5 border border-white/10 p-3 space-y-2",children:[e.jsxs("label",{className:"text-sm text-white/70",children:["Serviço ",s+1]}),e.jsx("input",{disabled:v,className:"w-full rounded-lg bg-black/30 border border-white/10 px-3 py-2 text-white placeholder-white/40 disabled:opacity-60",placeholder:`Título do serviço ${s+1}`,value:a.title,onChange:i=>{w(l=>{const c=[...l.services||[]];return c[s]={...c[s],title:i.target.value},{...l,services:c}})}}),e.jsx("textarea",{disabled:v,className:"w-full rounded-lg bg-black/30 border border-white/10 px-3 py-2 text-white placeholder-white/40 min-h-[80px] disabled:opacity-60",placeholder:"Descrição (opcional)",value:a.description||"",onChange:i=>{w(l=>{const c=[...l.services||[]];return c[s]={...c[s],description:i.target.value},{...l,services:c}})}})]},s))}),e.jsx("div",{className:"text-xs text-white/60",children:'* Se sua landing não usa "Serviços", basta deixar em branco — nada será publicado.'})]}):e.jsx("div",{className:"text-sm text-white/60",children:"Esta landing não usa cards de serviços."}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>z({}),disabled:B||v,className:"rounded-xl bg-white text-black px-4 py-2 text-sm font-medium hover:bg-white/90 disabled:opacity-60",children:B?"Salvando...":"Salvar alterações"})})]}),e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-white/[0.03] p-6 space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Personalize as cores do site"}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4",children:re.map(a=>e.jsxs("button",{disabled:v,onClick:()=>z({colors:a.colors}),className:"rounded-xl border border-white/10 bg-white/5 p-3 flex flex-col items-center hover:border-white/30 disabled:opacity-60",children:[e.jsx("div",{className:"flex gap-1 mb-2",children:a.colors.map(s=>e.jsx("div",{className:"w-6 h-6 rounded",style:{backgroundColor:s}},s))}),e.jsx("span",{className:"text-sm",children:a.name})]},a.name))}),(q=b.colors)!=null&&q.length?e.jsxs("div",{className:"text-sm text-white/70",children:[e.jsx("div",{className:"mt-4",children:"Paleta selecionada:"}),e.jsx("div",{className:"flex gap-2 mt-2",children:b.colors.map(a=>e.jsx("span",{className:"inline-flex items-center justify-center rounded px-2 py-1 border border-white/10",style:{backgroundColor:a},children:e.jsx("span",{className:"text-[10px] mix-blend-difference",children:a})},a))})]}):null]}),e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-white/[0.03] p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:"Feedbacks de Clientes"}),e.jsx("div",{className:"text-xs text-white/60",children:"E-mail e telefone ficam **somente aqui** (não são publicados)."})]}),W?e.jsx("div",{className:"text-white/60 text-sm",children:"Carregando…"}):L.length===0?e.jsx("div",{className:"text-white/60 text-sm",children:"Nenhum feedback ainda."}):e.jsx("div",{className:"space-y-3",children:L.map(a=>e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/60",children:[e.jsx("span",{children:I(a.timestamp)}),a.approved?e.jsx("span",{className:"rounded bg-emerald-500/20 text-emerald-300 px-2 py-0.5",children:"Publicado"}):e.jsx("span",{className:"rounded bg-yellow-500/20 text-yellow-300 px-2 py-0.5",children:"Pendente"})]}),e.jsxs("div",{className:"mt-1 text-sm flex flex-wrap gap-x-2 gap-y-1",children:[e.jsx("span",{className:"font-medium",children:a.name||"Cliente"}),typeof a.rating=="number"?e.jsxs("span",{children:["• ",a.rating,"/5"]}):null,a.email?e.jsxs("span",{className:"text-white/60",children:["• ",a.email]}):null,a.phone?e.jsxs("span",{className:"text-white/60",children:["• ",a.phone]}):null]}),a.comment?e.jsx("div",{className:"mt-1 text-white/80",children:a.comment}):null,e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{onClick:()=>M(a.id,!0),disabled:!g,className:"rounded-lg bg-emerald-500 text-black px-3 py-1.5 text-xs font-medium disabled:opacity-60",title:g?"":"Informe o PIN VIP no topo",children:"Publicar"}),e.jsx("button",{onClick:()=>M(a.id,!1),disabled:!g,className:"rounded-lg bg-slate-700 text-white px-3 py-1.5 text-xs font-medium disabled:opacity-60",title:g?"":"Informe o PIN VIP no topo",children:"Ocultar"})]})]},a.id))})]})]})]})}):null}function C({title:t,value:n}){return e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/[0.03] p-5",children:[e.jsx("div",{className:"text-sm text-white/70",children:t}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-white",children:n})]})}function oe({enabled:t,checking:n,children:d,teaser:m}){return t?e.jsx(e.Fragment,{children:d}):n?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none select-none opacity-70",children:d}),e.jsx("div",{className:"absolute inset-0 rounded-2xl bg-gradient-to-b from-transparent via-[#0B1220]/80 to-[#0B1220]"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 p-6",children:e.jsx("div",{className:"rounded-2xl border border-white/10 bg-white/10 backdrop-blur px-4 py-3 text-sm text-white",children:"Verificando sua assinatura…"})})]}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none select-none blur-[1.1px] opacity-80",children:d}),e.jsx("div",{className:"absolute inset-0 rounded-2xl bg-gradient-to-b from-transparent via-[#0B1220]/80 to-[#0B1220]"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 p-6",children:e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/10 backdrop-blur px-4 py-3 flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsx("div",{className:"text-sm text-white",children:m}),e.jsx("a",{href:H,target:"_blank",rel:"noreferrer",className:"shrink-0 rounded-xl bg-emerald-500 px-3 py-2 text-sm font-medium text-black hover:bg-emerald-400",children:"Fazer upgrade"})]})})]})}function ce({slot:t,loading:n,onSelectFile:d}){const[m,h]=r.useState(!1),x=m||n;return e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 overflow-hidden",children:[e.jsx("div",{className:"aspect-video bg-black/30 grid place-items-center",children:t.url?e.jsx("img",{src:t.url,alt:t.label,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-white/40 text-sm",children:n?"Carregando…":"Sem imagem"})}),e.jsxs("div",{className:"p-3 flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-sm text-white/80",children:t.label}),e.jsxs("label",{className:`inline-flex items-center justify-center px-3 py-1.5 rounded-lg text-sm cursor-pointer ${x?"bg-white/10 text-white/50 cursor-not-allowed":"bg-white text-black hover:bg-white/90"}`,children:[x?"Aguarde…":"Trocar",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",disabled:x,onChange:async u=>{var f;const p=(f=u.target.files)==null?void 0:f[0];if(p){h(!0);try{await d(p)}finally{h(!1),u.currentTarget.value=""}}}})]})]})]})}export{me as default};
