import{r,j as e}from"./index-C2aJ28FA.js";const T="/login";function P(){return r.useMemo(()=>new URLSearchParams(window.location.search),[])}function N(){const a=P(),n=(a.get("email")||a.get("e")||"").toLowerCase(),i=a.get("token")||a.get("t")||"",[_,d]=r.useState(n||i?"confirm":"request"),[p,E]=r.useState(n),[c,f]=r.useState(!1),[g,x]=r.useState(null),[b,m]=r.useState(null),[y,j]=r.useState(n),[v,S]=r.useState(i),[k,B]=r.useState(""),[h,w]=r.useState(!1),[s,q]=r.useState(null),[C,u]=r.useState(null),[z,L]=r.useState(5);r.useEffect(()=>{(n||i)&&(d("confirm"),j(n),S(i))},[n,i]),r.useEffect(()=>{if(!s)return;const o=setInterval(()=>{L(l=>l<=1?(clearInterval(o),window.location.assign(T),0):l-1)},1e3);return()=>clearInterval(o)},[s]);function R(o){switch(o){case"missing_email":case"missing_email_or_token":case"missing_email_or_token_or_password":return"Informe seu e-mail (e token quando aplicável).";case"user_not_found":return"Se existir uma conta com este e-mail, enviaremos o link. Verifique seu e-mail e spam.";case"invalid_token":case"token_invalid":case"token_expired":return"Token inválido ou expirado. Gere um novo link de redefinição.";case"weak_password":case"password_too_short":return"A nova senha deve ter pelo menos 6–8 caracteres.";default:return"Não foi possível completar a operação. Tente novamente."}}async function I(o){o.preventDefault(),f(!0),m(null),x(null);try{const t=await(await fetch("/.netlify/functions/reset-dispatch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p})})).json().catch(()=>({}));t!=null&&t.ok?x("Se existir uma conta com este e-mail, enviamos um link de redefinição. Confira também a caixa de spam."):m(R(t==null?void 0:t.error))}catch{m("Falha de rede. Tente novamente.")}finally{f(!1)}}async function D(o){o.preventDefault(),w(!0),u(null),q(null);try{const t=await(await fetch("/.netlify/functions/auth-reset-confirm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:y,token:v,password:k})})).json().catch(()=>({}));t!=null&&t.ok?q("Senha alterada com sucesso! Redirecionando para o login…"):u(R(t==null?void 0:t.error))}catch{u("Falha de rede. Tente novamente.")}finally{w(!1)}}return e.jsx("div",{style:{minHeight:"100vh",display:"grid",placeItems:"center",padding:16,background:"#f6f7f9"},children:e.jsx("div",{style:{width:420,maxWidth:"95vw",background:"#fff",border:"1px solid #e5e7eb",borderRadius:16,boxShadow:"0 8px 24px rgba(0,0,0,.06)",padding:24},children:_==="confirm"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,marginBottom:8},children:"Definir nova senha"}),e.jsxs("p",{style:{color:"#6b7280",marginBottom:16},children:["Cole o ",e.jsx("b",{children:"e-mail"})," e o ",e.jsx("b",{children:"token"})," que você recebeu e defina a nova senha."]}),e.jsxs("form",{onSubmit:D,children:[e.jsx("label",{style:{display:"block",fontSize:13,marginBottom:6},children:"E-mail"}),e.jsx("input",{type:"email",required:!0,value:y,onChange:o=>j(o.target.value),placeholder:"seu@exemplo.com",style:{width:"100%",height:40,borderRadius:10,border:"1px solid #d1d5db",padding:"0 12px",marginBottom:12}}),e.jsx("label",{style:{display:"block",fontSize:13,marginBottom:6},children:"Token"}),e.jsx("input",{required:!0,value:v,onChange:o=>S(o.target.value),placeholder:"xxxx-xxxx-xxxx...",style:{width:"100%",height:40,borderRadius:10,border:"1px solid #d1d5db",padding:"0 12px",marginBottom:12}}),e.jsx("label",{style:{display:"block",fontSize:13,marginBottom:6},children:"Nova senha"}),e.jsx("input",{type:"password",required:!0,minLength:6,value:k,onChange:o=>B(o.target.value),placeholder:"mínimo 6 caracteres",style:{width:"100%",height:40,borderRadius:10,border:"1px solid #d1d5db",padding:"0 12px",marginBottom:12}}),e.jsx("button",{disabled:h,style:{width:"100%",height:42,borderRadius:10,border:0,background:"black",color:"white",fontWeight:600,cursor:"pointer",opacity:h?.7:1},children:h?"Salvando...":"Salvar nova senha"})]}),s&&e.jsxs("div",{style:{color:"#065f46",marginTop:12},children:[e.jsx("p",{children:s}),e.jsx("button",{style:{width:"100%",marginTop:8,border:"1px solid #111",borderRadius:10,height:40,background:"#fff",cursor:"pointer"},onClick:()=>window.location.assign(T),children:"Ir para o login agora"}),e.jsxs("p",{style:{color:"#6b7280",fontSize:12,marginTop:6},children:["Redirecionando automaticamente em ",z,"s…"]})]}),C&&e.jsx("p",{style:{color:"#b91c1c",marginTop:12},children:C}),e.jsx("hr",{style:{margin:"16px 0",borderColor:"#eee"}}),e.jsxs("p",{style:{fontSize:13,color:"#6b7280"},children:["Precisa pedir um novo link?"," ",e.jsx("a",{href:"#",onClick:o=>{o.preventDefault(),d("request")},children:"Clique aqui"})]}),e.jsx("p",{style:{fontSize:13,color:"#6b7280",marginTop:6},children:e.jsx("a",{href:"/",children:"Voltar para a home"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,marginBottom:8},children:"Redefinir senha"}),e.jsx("p",{style:{color:"#6b7280",marginBottom:16},children:"Informe seu e-mail para enviarmos um link de redefinição."}),e.jsxs("form",{onSubmit:I,children:[e.jsx("label",{style:{display:"block",fontSize:13,marginBottom:6},children:"E-mail"}),e.jsx("input",{type:"email",required:!0,value:p,onChange:o=>E(o.target.value),placeholder:"seu@exemplo.com",style:{width:"100%",height:40,borderRadius:10,border:"1px solid #d1d5db",padding:"0 12px",marginBottom:12}}),e.jsx("button",{disabled:c,style:{width:"100%",height:42,borderRadius:10,border:0,background:"black",color:"white",fontWeight:600,cursor:"pointer",opacity:c?.7:1},children:c?"Enviando...":"Enviar link"})]}),g&&e.jsx("p",{style:{color:"#065f46",marginTop:12},children:g}),b&&e.jsx("p",{style:{color:"#b91c1c",marginTop:12},children:b}),e.jsx("hr",{style:{margin:"16px 0",borderColor:"#eee"}}),e.jsxs("p",{style:{fontSize:13,color:"#6b7280"},children:["Já tem ",e.jsx("b",{children:"token"}),"?"," ",e.jsx("a",{href:"#",onClick:o=>{o.preventDefault(),d("confirm")},children:"Definir nova senha"})]}),e.jsx("p",{style:{fontSize:13,color:"#6b7280",marginTop:6},children:e.jsx("a",{href:"/",children:"Voltar para a home"})})]})})})}export{N as default};
//# sourceMappingURL=index-BxAygUea.js.map
