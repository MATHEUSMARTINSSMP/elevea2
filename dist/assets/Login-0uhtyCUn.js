import{r as n,j as t}from"./index-DbIv-HuQ.js";const y="/.netlify/functions/auth-session",L=`${y}?action=login`,C=`${y}?action=me`,R="/.netlify/functions/reset-dispatch";function $(){const[u,b]=n.useState(""),[m,j]=n.useState(""),[h,p]=n.useState(!1),[x,l]=n.useState(null),[f,r]=n.useState(null),[v,c]=n.useState(!1),[g,N]=n.useState(""),d=n.useMemo(()=>{try{const e=new URLSearchParams(window.location.search).get("next")||"";return e.startsWith("/")?e:""}catch{return""}},[]);n.useEffect(()=>{(async()=>{try{const e=await(await fetch(C,{credentials:"include",cache:"no-store"})).json().catch(()=>({}));e!=null&&e.ok&&e.user&&w(e.user.role,d)}catch{}})()},[d]);function w(s,e){if(e){if(s==="admin"&&e.startsWith("/admin/")){window.location.assign(e);return}if(s==="client"&&e.startsWith("/client/")){window.location.assign(e);return}}window.location.assign(s==="admin"?"/admin/dashboard":"/client/dashboard")}async function S(s){var e;s.preventDefault(),r(null),l(null),p(!0);try{const a=u.trim().toLowerCase(),o=await fetch(L,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:a,password:m})});if(o.status>=500){const k=await o.text().catch(()=>"");r(`Servidor indisponível (${o.status}). ${k||""}`.trim());return}const i=await o.json().catch(()=>({}));if(!o.ok||i.ok===!1){r(i.error||i.message||`Falha no login (${o.status})`);return}if(!((e=i.user)!=null&&e.role)){r("Resposta inválida do servidor.");return}w(i.user.role,d)}catch(a){r((a==null?void 0:a.message)||"Erro de rede")}finally{p(!1)}}async function E(s){s.preventDefault(),r(null),l(null);try{const e=await fetch(R,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"password_reset_request",email:g.trim().toLowerCase(),siteSlug:""})}),a=await e.json().catch(()=>({}));if(!e.ok||a.ok===!1){r(a.error||a.message||`Falha no reset (${e.status})`);return}a.link?l(`Link de reset: ${a.link}`):l("Se o e-mail existir, enviamos um link de reset."),c(!1)}catch(e){r((e==null?void 0:e.message)||"Erro de rede")}}return t.jsxs("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-6",children:[t.jsxs("div",{className:"w-full max-w-md bg-white rounded-2xl shadow p-8",children:[t.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Entrar"}),t.jsxs("form",{className:"space-y-4",onSubmit:S,children:[t.jsx("input",{type:"email",placeholder:"E-mail",value:u,onChange:s=>b(s.target.value),className:"w-full border rounded-xl px-4 py-3",autoComplete:"username",required:!0}),t.jsx("input",{type:"password",placeholder:"Senha",value:m,onChange:s=>j(s.target.value),className:"w-full border rounded-xl px-4 py-3",autoComplete:"current-password",required:!0}),t.jsx("button",{type:"submit",disabled:h,className:"w-full bg-black text-white rounded-xl py-3 hover:bg-gray-800",children:h?"Entrando...":"Entrar"})]}),t.jsx("div",{className:"mt-4 text-sm",children:t.jsx("button",{className:"text-blue-600 underline",onClick:()=>c(!0),children:"Esqueci a senha"})}),f&&t.jsx("div",{className:"mt-4 text-red-600 whitespace-pre-wrap",children:f}),x&&t.jsx("div",{className:"mt-4 text-green-600 break-words",children:x})]}),v&&t.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center",children:t.jsxs("div",{className:"bg-white w-full max-w-md rounded-xl shadow p-6",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Reset de Senha"}),t.jsxs("form",{className:"space-y-4",onSubmit:E,children:[t.jsx("input",{type:"email",placeholder:"E-mail",value:g,onChange:s=>N(s.target.value),className:"w-full border rounded-xl px-4 py-3",required:!0}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{type:"submit",className:"bg-black text-white rounded-xl px-4 py-2",children:"Enviar link"}),t.jsx("button",{type:"button",className:"border rounded-xl px-4 py-2",onClick:()=>c(!1),children:"Fechar"})]})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Você receberá um link para criar uma nova senha."})]})})]})}export{$ as default};
